name: Check GitHub Actions Scripts
description: Check shell scripts in GitHub Actions workflows and actions

inputs:
  check_scripts:
    type: boolean
    required: false
    default: true
  scripts_dir:
    type: string
    required: false
    default: .
  check_actions:
    type: boolean
    required: false
    default: true
  actions_dir:
    type: string
    required: false
    default: .github/actions
  check_workflows:
    type: boolean
    required: false
    default: true
  workflows_dir:
    type: string
    required: false
    default: .github/workflows

runs:
  using: composite
  steps:
    - name: Install shellcheck and yq
      shell: bash
      run: |
        echo "::group::Installing shellcheck and yq"
        sudo apt update
        sudo apt install -y shellcheck yq jq
        echo "::endgroup::"
        shellcheck --version
        yq --version
        jq --version

    - name: Checks
      shell: bash
      run: |
        CHECK_SCRIPTS="${{ inputs.check_scripts }}"
        CHECK_ACTIONS="${{ inputs.check_actions }}"
        CHECK_WORKFLOWS="${{ inputs.check_workflows }}"

        SUCCESS=true

        if [ "$CHECK_SCRIPTS" = "true" ]; then
          "$GITHUB_ACTION_PATH/check-scripts.sh" "${{ inputs.scripts_dir }}" || SUCCESS=false
        fi
        if [ "$CHECK_ACTIONS" = "true" ]; then
          "$GITHUB_ACTION_PATH/check-actions.sh" "${{ inputs.actions_dir }}" || SUCCESS=false
        fi
        if [ "$CHECK_WORKFLOWS" = "true" ]; then
          "$GITHUB_ACTION_PATH/check-workflows.sh" "${{ inputs.workflows_dir }}" || SUCCESS=false
        fi

        if [ "$SUCCESS" = "false" ]; then
          exit 1
        fi
